type qcrilam_app, domain;

app_domain(qcrilam_app)

# Needed to get access to /data/data/com.sony.qcrilam
# Also possible to use system_data_app_file, but better to have less privileges
# avc: granted { search } for comm="om.sony.qcrilam" name="com.sony.qcrilam" dev="mmcblk0p54" ino=311305 scontext=u:r:qcrilam_app:s0 tcontext=u:object_r:app_data_file:s0 tclass=dir
# avc: granted { getattr } for path="/data/data/com.sony.qcrilam" dev="mmcblk0p54" ino=868390 scontext=u:r:qcrilam_app:s0 tcontext=u:object_r:app_data_file:s0 tclass=dir
allow qcrilam_app app_data_file:dir { getattr search };
allow qcrilam_app app_data_file:file rw_file_perms;
# TODO: Remove me
userdebug_or_eng(`
  auditallow qcrilam_app app_data_file:dir { getattr search };
  auditallow qcrilam_app app_data_file:file rw_file_perms;
')

# avc: denied { find } for service=activity pid=2061 uid=1000 scontext=u:r:qcrilam_app:s0 tcontext=u:object_r:activity_service:s0 tclass=service_manager
allow qcrilam_app activity_service:service_manager find;

# TODO: Can't find audits for this
#add_service(qcrilam_app, qcrilam_service)
#auditallow qcrilam_app qcrilam_service:service_manager { add find };

# TODO(vndbinder): Switch to vndbinder
#vndbinder_use(qcrilam_app)

# Needed!
binder_use(qcrilam_app)
# avc: granted { call } for comm="HwBinder:2061_1" scontext=u:r:qcrilam_app:s0 tcontext=u:r:servicemanager:s0 tclass=binder
# avc: granted { call } for comm="re-initialized>" scontext=u:r:qcrilam_app:s0 tcontext=u:r:servicemanager:s0 tclass=binder
# avc: granted { search } for comm="servicemanager" name="1603" dev="proc" ino=13148 scontext=u:r:servicemanager:s0 tcontext=u:r:qcrilam_app:s0 tclass=dir

# TODO: Needed?
allow qcrilam_app vnd_qcrilhook_hwservice:hwservice_manager { find };
userdebug_or_eng(`
  auditallow qcrilam_app vnd_qcrilhook_hwservice:hwservice_manager { find };
')

# TODO: Needed?
#binder_call(qcrilam_app, vnd_qcrilhook_hwservice)
#auditallow qcrilam_app vnd_qcrilhook_hwservice:binder { call transfer };
#auditallow vnd_qcrilhook_hwservice qcrilam_app:binder { transfer };

# Needed!
binder_call(qcrilam_app, rild)
# avc: granted { call } for comm="om.sony.qcrilam" scontext=u:r:qcrilam_app:s0 tcontext=u:r:rild:s0 tclass=binder
# avc: granted { transfer } for comm="om.sony.qcrilam" scontext=u:r:qcrilam_app:s0 tcontext=u:r:rild:s0 tclass=binder

# Needed!
# avc: denied { find } for service=media.audio_flinger pid=2061 uid=1000 scontext=u:r:qcrilam_app:s0 tcontext=u:object_r:audioserver_service:s0 tclass=service_manager
allow qcrilam_app audioserver_service:service_manager { find };
