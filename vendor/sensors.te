# Policy for sensor daemon
type sensors, domain;
type sensors_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(sensors)

allow sensors self:capability {
    net_bind_service
};

userdebug_or_eng(`
  allow sensors diag_device:chr_file rw_file_perms;
')

allow sensors self:socket create_socket_perms;
allowxperm sensors self:socket ioctl msm_sock_ipc_ioctls;

allow sensors { persist_sensors_file sensors_persist_file }:dir rw_dir_perms;
allow sensors { persist_sensors_file sensors_persist_file }:file create_file_perms;
allow sensors persist_file:dir { getattr search };
# Fix stock labels
type_transition sensors {
  persist_file
  sensors_persist_file
}:{ dir file } persist_sensors_file;

# Search /data
allow sensors system_data_file:dir getattr;
# Read/write /data/vendor/sensors/*
allow sensors sensors_vendor_data_file:dir create_dir_perms;
allow sensors sensors_vendor_data_file:file create_file_perms;

# Access config files
allow sensors mnt_vendor_file:dir { getattr search };

allow sensors sensors_device:chr_file r_file_perms;

r_dir_file(sensors, sysfs_msm_subsys)
r_dir_file(sensors, sysfs_soc)
r_dir_file(sensors, sysfs_esoc)

dontaudit sensors kernel:system { module_request };
dontaudit sensors diag_device:chr_file rw_file_perms;
