vndbinder_use(hal_camera_default);
allow hal_camera_default qdisplay_service:service_manager find;

allow hal_camera_default {
     fwk_display_hwservice
     hal_graphics_mapper_hwservice
}:hwservice_manager find;

binder_call(hal_camera_default, hal_graphics_composer)
binder_call(hal_camera_default, system_server)
binder_call(hal_camera_default, hal_graphics_allocator)
binder_call(hal_camera_default, surfaceflinger)

set_prop(hal_camera_default, camera_prop)

allow hal_camera_default vendor_camera_prop:file r_file_perms;

allow hal_camera_default sysfs_camera:dir r_dir_perms;
allow hal_camera_default sysfs_camera:file r_file_perms;

allow hal_camera_default gpu_device:chr_file rw_file_perms;

allow hal_camera_default hal_power_default:unix_stream_socket connectto;
allow hal_camera_default powerhal_socket:dir search;
allow hal_camera_default powerhal_socket:sock_file write;

unix_socket_connect(hal_camera_default, cashsvr, cashsvr)
allow hal_camera_default cashsvr_socket:dir search;
allow hal_camera_default cashsvr_socket:sock_file write;

# avc: denied { open } for path="/sys/devices/platform/soc/900000.qcom,mdss_rotator/video4linux/video0/name" dev="sysfs" ino=41736 scontext=u:r:hal_camera_default:s0 tcontext=u:object_r:sysfs_msm_subsys:s0 tclass=file
allow hal_camera_default sysfs_msm_subsys:dir r_dir_perms;
allow hal_camera_default sysfs_msm_subsys:file r_file_perms;
# avc: denied { open } for path="/sys/bus/esoc/devices" dev="sysfs" ino=28289 scontext=u:r:hal_camera_default:s0 tcontext=u:object_r:sysfs_bus_esoc:s0 tclass=dir
# /sys/bus/esoc/devices is now sysfs_bus_esoc
r_dir_file(hal_camera_default, sysfs_bus_esoc)

allow hal_camera_default camera_vendor_data_file:dir rw_dir_perms;
allow hal_camera_default camera_vendor_data_file:file create_file_perms;

# avc: denied { create } for comm="android.hardwar" scontext=u:r:hal_camera_default:s0 tcontext=u:r:hal_camera_default:s0 tclass=socket
allow hal_camera_default self:socket create;

# avc: denied { set } for property=persist.vendor.camera.debug.logfile pid=596 uid=1047 gid=1005 scontext=u:r:hal_camera_default:s0 tcontext=u:object_r:vendor_camera_prop:s0 tclass=property_service
get_prop(hal_camera_default, vendor_camera_prop)
set_prop(hal_camera_default, vendor_camera_prop)

# avc: granted { module_request } for comm="android.hardwar" kmod="net-pf-42" scontext=u:r:hal_camera_default:s0 tcontext=u:r:kernel:s0 tclass=system
# Follow crosshatch sepolicy and ignore
dontaudit hal_camera_default kernel:system module_request;
