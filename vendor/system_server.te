allow system_server self:socket ioctl;
allowxperm system_server self:socket ioctl msm_sock_ipc_ioctls;

binder_call(system_server, hal_camera_default)

allow system_server wlan_device:chr_file rw_file_perms;

# input files
r_dir_file(system_server, idc_file)
r_dir_file(system_server, keylayout_file)

# Allow system_server to write to /proc/<pid>/timerslack_ns
allow system_server appdomain:file w_file_perms;
allow system_server audioserver:file w_file_perms;
allow system_server hal_audio_default:file w_file_perms;

allow system_server netmgrd_socket:dir r_dir_perms;
allow system_server self:socket ioctl;
allowxperm system_server self:socket ioctl msm_sock_ipc_ioctls;

# radio
rw_dir_file(system_server, qmuxd_socket)

# rtc: hctosys gets acessed by AlarmManagerService via system_server
# Felix: What is this??? AlarmManagerService: Unable to set rtc to 1544520598: Invalid argument
allow system_server sysfs_rtc:dir r_dir_perms;
allow system_server sysfs_rtc:{ file lnk_file } r_file_perms;

# TODO: Is this necessary? Probably yes.
# avc: granted { syslog_read } for comm="Thread-9" scontext=u:r:system_server:s0 tcontext=u:r:kernel:s0 tclass=system
allow system_server kernel:system syslog_read;
userdebug_or_eng(`
  auditallow system_server kernel:system syslog_read;
')

# avc: denied { read open } for comm="Binder:1181_7" path="/mnt/media_rw/0A3C-120F/Android/data" dev="mmcblk1p1" ino=75 scontext=u:r:system_server:s0 tcontext=u:object_r:vfat:s0 tclass=dir
# private/system_server.te:
# Do not allow opening files from external storage as unsafe ejection
# could cause the kernel to kill the system_server.
#neverallow system_server sdcard_type:dir { open read write };
dontaudit system_server vfat:dir r_dir_perms;
