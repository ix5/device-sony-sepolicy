# Policy for /system/bin/pm-proxy
type per_proxy, domain;
type per_proxy_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(per_proxy)

# TODO(b/vndswitch): Remove once per_proxy uses vendor binder
typeattribute per_proxy binder_in_vendor_violators_fake;

vndbinder_use(per_proxy)
# TODO(b/vndswitch): Remove once per_proxy uses vendor binder
binder_use(per_proxy)
# TODO(b/vndswitch): This is unnecessary because binder_in_vendor_violators
# already grants access to binder_device. Keep this comment until we sitch
# PeripheralManager to vndbinder, at which point vndbinder_use will allow
# access to vndbinder_device.
#allow per_proxy binder_device:chr_file rw_file_perms;

binder_call(per_proxy, per_mgr)

allow per_proxy per_mgr_service:service_manager find;
# Might also expand this to add_service(per_mgr_service)

r_dir_file(per_proxy, sysfs_msm_subsys)
# avc: denied { read } for name="devices" dev="sysfs" ino=28289 scontext=u:r:per_proxy:s0 tcontext=u:object_r:sysfs_esoc:s0 tclass=dir
allow per_proxy sysfs_esoc:dir { search open read };
