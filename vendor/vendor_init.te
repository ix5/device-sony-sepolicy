typeattribute vendor_init data_between_core_and_vendor_violators;

# TODO: some of this is from marlin, is this necessary?
allow vendor_init {
    adb_keys_file
    audio_data_file
    bluetooth_data_file
    camera_data_file
    dhcp_data_file
    radio_vendor_data_file
    rootfs
    sensors_vendor_data_file
    system_data_file
    tombstone_data_file
    wifi_data_file
}:dir { create search getattr open read setattr ioctl write add_name remove_name rmdir relabelfrom };
# TODO: is create_dir_perms enough?
#}:dir create_dir_perms;

allow vendor_init radio_vendor_data_file:file create_file_perms;
dontaudit vendor_init kernel:system module_request;

# TODO: Make this more specific
# QUESTION: Which files?
# TODO: Remove auditallow statements
allow vendor_init proc:file write;
auditallow vendor_init proc:file write;
allow vendor_init proc_security:file write;
auditallow vendor_init proc_security:file write;
allow vendor_init persist_file:lnk_file read;
auditallow vendor_init persist_file:lnk_file read;
allow vendor_init qdsp_file:lnk_file read;
auditallow vendor_init qdsp_file:lnk_file read;

# avc: denied { create } for comm="init" name="cpus" scontext=u:r:vendor_init:s0 tcontext=u:object_r:device:s0 tclass=file permissive=1
# avc: denied { write } for comm="init" path="/dev/cpuset/foreground/cpus" dev="tmpfs" ino=25046 scontext=u:r:vendor_init:s0 tcontext=u:object_r:device:s0 tclass=file permissive=1
# avc: denied { write } for comm="init" name="default_smp_affinity" dev="proc" ino=4026531867 scontext=u:r:vendor_init:s0 tcontext=u:object_r:proc_irq:s0 tclass=file permissive=1
# TODO: Make this more specific
# QUESTION: Which files?
# TODO: Remove auditallow statements
allow vendor_init device:file { create write };
auditallow vendor_init device:file { create write };
allow vendor_init proc_irq:file w_file_perms;
auditallow vendor_init proc_irq:file w_file_perms;

# from crosshatch:
# TODO: Check and maybe remove
allow vendor_init unlabeled:dir { getattr relabelfrom };
# TODO: Remove auditallow statements
auditallow vendor_init unlabeled:dir relabelfrom;

# avc: denied { relabelfrom } for name="dsp" dev="rootfs" ino=1222 scontext=u:r:vendor_init:s0 tcontext=u:object_r:rootfs:s0 tclass=lnk_file permissive=0
# avc: denied { relabelfrom } for name="persist" dev="rootfs" ino=1245 scontext=u:r:vendor_init:s0 tcontext=u:object_r:rootfs:s0 tclass=lnk_file permissive=0
allow vendor_init rootfs:lnk_file relabelfrom;
# TODO: Remove auditallow statements
auditallow vendor_init rootfs:lnk_file relabelfrom;
